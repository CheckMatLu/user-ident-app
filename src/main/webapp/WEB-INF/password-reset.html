<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>Password Reset</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

<script language="javascript">

function isEmpty(str){
	return(!str || 0 === str.trim().length());
}

function saveNewPassword(){
	val urlParams = new URLSearchParams(location.search);
	if(!urlParams.hasToken('token') || isEmpty(urlParams.getToken('token'))){
		alert("Missing required token");
		return;
	}
	
	vat tokenValue = urlParams.getToken('token');
	var password = document.getElementById("password").value;
	var passwordVerif = document.getElementById("password_verif").value;
	
	if(isEmpty(password)){
		alert("Password emtpy");
		return;
	}
	
	if(password !== passwordVerif){
		alert("Passwords does not match");
		return;
	}
	
	$ .ajaxSetup({
		"contentType": "application/json"
	})
	
	var dataPayload = { "token": tokenValue,
		"password": password };
	
	$.post("http://localhost:8080/users/password-reset-request", JSON.stringify(dataPayload))
		.done(function(response){
			document.getElementById("password").value="";
			document.getElementById("password_verif").value="";
			
			if(response["operationResult"] === "SUCCESS"){
				$("#unsuccessful-reset").attr("style", "style", "display:none !important;");
				$("#successful-reset").attr("style", "style", "display:block !important;");
			} else{
				$("#unsuccessful-reset").attr("style", "style", "display:block !important;");
				$("#successful-reset").attr("style", "style", "display:none !important;");
			}
		});
}

</script>
</head>
<body>

	<div id="successful-reset" style="display:none">Your password is now updated</div>
	<div id="unsuccessful-reset" style="display:none">Password can not be reset</div>
	
	<form>
		New password: <input type="password" id="password"/><br/>
		Retype your password: <input type="password" id="password_verif"/><br/>
		<input type ="button" value="Save new passord" onclick="javascript:saveNewPassword()"/>
	</form>
</body>
</html>